<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express | My Programming Blog</title><meta name=keywords content="javascript,nodejs,express,api,backend"><meta name=description content="H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v·ªõi Node.js v√† Express framework"><meta name=author content="Thanh Tai"><link rel=canonical href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-nodejs-express/><link crossorigin=anonymous href=/my-programming-blog/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as=style><link rel=icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon-32x32.png><link rel=apple-touch-icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/apple-touch-icon.png><link rel=mask-icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-nodejs-express/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-nodejs-express/"><meta property="og:site_name" content="My Programming Blog"><meta property="og:title" content="X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express"><meta property="og:description" content="H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v·ªõi Node.js v√† Express framework"><meta property="og:locale" content="vi"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-10T13:30:00+07:00"><meta property="article:modified_time" content="2024-01-10T13:30:00+07:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Nodejs"><meta property="article:tag" content="Express"><meta property="article:tag" content="Api"><meta property="article:tag" content="Backend"><meta name=twitter:card content="summary"><meta name=twitter:title content="X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express"><meta name=twitter:description content="H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v·ªõi Node.js v√† Express framework"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/"},{"@type":"ListItem","position":2,"name":"X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express","item":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-nodejs-express/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express","name":"X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express","description":"H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v·ªõi Node.js v√† Express framework","keywords":["javascript","nodejs","express","api","backend"],"articleBody":"X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express Node.js v√† Express l√† m·ªôt combo m·∫°nh m·∫Ω ƒë·ªÉ x√¢y d·ª±ng REST API. Trong b√†i vi·∫øt n√†y, t√¥i s·∫Ω h∆∞·ªõng d·∫´n b·∫°n c√°ch t·∫°o m·ªôt REST API ho√†n ch·ªânh t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.\nT·∫°i Sao Ch·ªçn Node.js v√† Express? JavaScript Everywhere: S·ª≠ d·ª•ng JavaScript cho c·∫£ frontend v√† backend NPM Ecosystem: Th∆∞ vi·ªán phong ph√∫ v√† c·ªông ƒë·ªìng l·ªõn Performance: Non-blocking I/O cho hi·ªáu su·∫•t cao Scalability: D·ªÖ d√†ng scale horizontal Rapid Development: Ph√°t tri·ªÉn nhanh ch√≥ng Thi·∫øt L·∫≠p D·ª± √Ån 1. Kh·ªüi t·∫°o d·ª± √°n 1 2 3 mkdir my-api cd my-api npm init -y 2. C√†i ƒë·∫∑t dependencies 1 2 3 4 5 npm install express cors helmet morgan compression npm install mongoose bcryptjs jsonwebtoken npm install express-validator express-rate-limit npm install dotenv npm install -D nodemon 3. C·∫•u tr√∫c th∆∞ m·ª•c 1 2 3 4 5 6 7 8 9 10 11 12 13 my-api/ ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ controllers/ ‚îÇ ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îú‚îÄ‚îÄ routes/ ‚îÇ ‚îú‚îÄ‚îÄ middleware/ ‚îÇ ‚îú‚îÄ‚îÄ utils/ ‚îÇ ‚îî‚îÄ‚îÄ app.js ‚îú‚îÄ‚îÄ config/ ‚îÇ ‚îî‚îÄ‚îÄ database.js ‚îú‚îÄ‚îÄ .env ‚îú‚îÄ‚îÄ package.json ‚îî‚îÄ‚îÄ server.js T·∫°o Server C∆° B·∫£n 1. server.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const morgan = require('morgan'); const compression = require('compression'); require('dotenv').config(); const app = require('./src/app'); const PORT = process.env.PORT || 3000; // Middleware app.use(helmet()); app.use(cors()); app.use(compression()); app.use(morgan('combined')); app.use(express.json({ limit: '10mb' })); app.use(express.urlencoded({ extended: true })); // Routes app.use('/api/users', require('./src/routes/userRoutes')); app.use('/api/products', require('./src/routes/productRoutes')); // Error handling middleware app.use((err, req, res, next) =\u003e { console.error(err.stack); res.status(500).json({ success: false, message: 'Something went wrong!', error: process.env.NODE_ENV === 'development' ? err.message : {} }); }); // 404 handler app.use('*', (req, res) =\u003e { res.status(404).json({ success: false, message: 'Route not found' }); }); app.listen(PORT, () =\u003e { console.log(`Server running on port ${PORT}`); }); 2. app.js 1 2 3 4 5 6 7 8 9 10 11 12 13 const express = require('express'); const app = express(); // Health check endpoint app.get('/health', (req, res) =\u003e { res.json({ success: true, message: 'Server is running', timestamp: new Date().toISOString() }); }); module.exports = app; K·∫øt N·ªëi Database 1. config/database.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const mongoose = require('mongoose'); const connectDB = async () =\u003e { try { const conn = await mongoose.connect(process.env.MONGODB_URI, { useNewUrlParser: true, useUnifiedTopology: true, }); console.log(`MongoDB Connected: ${conn.connection.host}`); } catch (error) { console.error('Database connection error:', error); process.exit(1); } }; module.exports = connectDB; 2. .env 1 2 3 4 5 6 NODE_ENV=development PORT=3000 MONGODB_URI=mongodb://localhost:27017/myapi JWT_SECRET=your-secret-key JWT_EXPIRE=7d BCRYPT_ROUNDS=12 T·∫°o Models 1. User Model 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 const mongoose = require('mongoose'); const bcrypt = require('bcryptjs'); const userSchema = new mongoose.Schema({ username: { type: String, required: [true, 'Username is required'], unique: true, trim: true, minlength: [3, 'Username must be at least 3 characters'], maxlength: [30, 'Username cannot exceed 30 characters'] }, email: { type: String, required: [true, 'Email is required'], unique: true, lowercase: true, match: [/^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email'] }, password: { type: String, required: [true, 'Password is required'], minlength: [6, 'Password must be at least 6 characters'], select: false }, firstName: { type: String, required: [true, 'First name is required'], trim: true, maxlength: [50, 'First name cannot exceed 50 characters'] }, lastName: { type: String, required: [true, 'Last name is required'], trim: true, maxlength: [50, 'Last name cannot exceed 50 characters'] }, role: { type: String, enum: ['user', 'admin', 'moderator'], default: 'user' }, isActive: { type: Boolean, default: true }, lastLogin: { type: Date } }, { timestamps: true }); // Hash password before saving userSchema.pre('save', async function(next) { if (!this.isModified('password')) return next(); this.password = await bcrypt.hash(this.password, parseInt(process.env.BCRYPT_ROUNDS)); next(); }); // Compare password method userSchema.methods.comparePassword = async function(candidatePassword) { return await bcrypt.compare(candidatePassword, this.password); }; // Remove password from JSON output userSchema.methods.toJSON = function() { const userObject = this.toObject(); delete userObject.password; return userObject; }; module.exports = mongoose.model('User', userSchema); 2. Product Model 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 const mongoose = require('mongoose'); const productSchema = new mongoose.Schema({ name: { type: String, required: [true, 'Product name is required'], trim: true, maxlength: [100, 'Product name cannot exceed 100 characters'] }, description: { type: String, required: [true, 'Product description is required'], maxlength: [500, 'Description cannot exceed 500 characters'] }, price: { type: Number, required: [true, 'Product price is required'], min: [0, 'Price cannot be negative'] }, category: { type: String, required: [true, 'Product category is required'], enum: ['electronics', 'clothing', 'books', 'home', 'sports'] }, stock: { type: Number, required: [true, 'Stock quantity is required'], min: [0, 'Stock cannot be negative'], default: 0 }, images: [{ type: String, validate: { validator: function(v) { return /^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|webp)$/i.test(v); }, message: 'Invalid image URL' } }], tags: [{ type: String, trim: true }], isActive: { type: Boolean, default: true }, createdBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true } }, { timestamps: true }); // Index for search productSchema.index({ name: 'text', description: 'text', tags: 'text' }); module.exports = mongoose.model('Product', productSchema); T·∫°o Controllers 1. User Controller 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 const User = require('../models/User'); const jwt = require('jsonwebtoken'); // Generate JWT Token const generateToken = (id) =\u003e { return jwt.sign({ id }, process.env.JWT_SECRET, { expiresIn: process.env.JWT_EXPIRE }); }; // @desc Register user // @route POST /api/users/register // @access Public const registerUser = async (req, res) =\u003e { try { const { username, email, password, firstName, lastName } = req.body; // Check if user exists const existingUser = await User.findOne({ $or: [{ email }, { username }] }); if (existingUser) { return res.status(400).json({ success: false, message: 'User already exists with this email or username' }); } // Create user const user = await User.create({ username, email, password, firstName, lastName }); const token = generateToken(user._id); res.status(201).json({ success: true, message: 'User registered successfully', data: { user, token } }); } catch (error) { res.status(500).json({ success: false, message: 'Error registering user', error: error.message }); } }; // @desc Login user // @route POST /api/users/login // @access Public const loginUser = async (req, res) =\u003e { try { const { email, password } = req.body; // Check if user exists and include password const user = await User.findOne({ email }).select('+password'); if (!user) { return res.status(401).json({ success: false, message: 'Invalid credentials' }); } // Check password const isPasswordValid = await user.comparePassword(password); if (!isPasswordValid) { return res.status(401).json({ success: false, message: 'Invalid credentials' }); } // Update last login user.lastLogin = new Date(); await user.save(); const token = generateToken(user._id); res.json({ success: true, message: 'Login successful', data: { user, token } }); } catch (error) { res.status(500).json({ success: false, message: 'Error logging in', error: error.message }); } }; // @desc Get current user // @route GET /api/users/me // @access Private const getMe = async (req, res) =\u003e { try { const user = await User.findById(req.user.id); res.json({ success: true, data: user }); } catch (error) { res.status(500).json({ success: false, message: 'Error getting user profile', error: error.message }); } }; // @desc Get all users // @route GET /api/users // @access Private/Admin const getUsers = async (req, res) =\u003e { try { const page = parseInt(req.query.page) || 1; const limit = parseInt(req.query.limit) || 10; const skip = (page - 1) * limit; const users = await User.find() .select('-password') .skip(skip) .limit(limit) .sort({ createdAt: -1 }); const total = await User.countDocuments(); res.json({ success: true, data: users, pagination: { page, limit, total, pages: Math.ceil(total / limit) } }); } catch (error) { res.status(500).json({ success: false, message: 'Error getting users', error: error.message }); } }; module.exports = { registerUser, loginUser, getMe, getUsers }; 2. Product Controller 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 const Product = require('../models/Product'); // @desc Get all products // @route GET /api/products // @access Public const getProducts = async (req, res) =\u003e { try { const page = parseInt(req.query.page) || 1; const limit = parseInt(req.query.limit) || 10; const skip = (page - 1) * limit; const { category, search, minPrice, maxPrice, sort } = req.query; // Build filter object const filter = { isActive: true }; if (category) { filter.category = category; } if (search) { filter.$text = { $search: search }; } if (minPrice || maxPrice) { filter.price = {}; if (minPrice) filter.price.$gte = parseFloat(minPrice); if (maxPrice) filter.price.$lte = parseFloat(maxPrice); } // Build sort object let sortObj = { createdAt: -1 }; if (sort) { switch (sort) { case 'price-asc': sortObj = { price: 1 }; break; case 'price-desc': sortObj = { price: -1 }; break; case 'name-asc': sortObj = { name: 1 }; break; case 'name-desc': sortObj = { name: -1 }; break; } } const products = await Product.find(filter) .populate('createdBy', 'username firstName lastName') .skip(skip) .limit(limit) .sort(sortObj); const total = await Product.countDocuments(filter); res.json({ success: true, data: products, pagination: { page, limit, total, pages: Math.ceil(total / limit) } }); } catch (error) { res.status(500).json({ success: false, message: 'Error getting products', error: error.message }); } }; // @desc Get single product // @route GET /api/products/:id // @access Public const getProduct = async (req, res) =\u003e { try { const product = await Product.findById(req.params.id) .populate('createdBy', 'username firstName lastName'); if (!product) { return res.status(404).json({ success: false, message: 'Product not found' }); } res.json({ success: true, data: product }); } catch (error) { res.status(500).json({ success: false, message: 'Error getting product', error: error.message }); } }; // @desc Create product // @route POST /api/products // @access Private const createProduct = async (req, res) =\u003e { try { const productData = { ...req.body, createdBy: req.user.id }; const product = await Product.create(productData); res.status(201).json({ success: true, message: 'Product created successfully', data: product }); } catch (error) { res.status(500).json({ success: false, message: 'Error creating product', error: error.message }); } }; module.exports = { getProducts, getProduct, createProduct }; Middleware 1. Authentication Middleware 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 const jwt = require('jsonwebtoken'); const User = require('../models/User'); const protect = async (req, res, next) =\u003e { try { let token; if (req.headers.authorization \u0026\u0026 req.headers.authorization.startsWith('Bearer')) { token = req.headers.authorization.split(' ')[1]; } if (!token) { return res.status(401).json({ success: false, message: 'Access denied. No token provided.' }); } const decoded = jwt.verify(token, process.env.JWT_SECRET); const user = await User.findById(decoded.id); if (!user) { return res.status(401).json({ success: false, message: 'Token is not valid.' }); } req.user = user; next(); } catch (error) { res.status(401).json({ success: false, message: 'Token is not valid.' }); } }; const authorize = (...roles) =\u003e { return (req, res, next) =\u003e { if (!roles.includes(req.user.role)) { return res.status(403).json({ success: false, message: `User role ${req.user.role} is not authorized to access this route` }); } next(); }; }; module.exports = { protect, authorize }; 2. Validation Middleware 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 const { body, validationResult } = require('express-validator'); const handleValidationErrors = (req, res, next) =\u003e { const errors = validationResult(req); if (!errors.isEmpty()) { return res.status(400).json({ success: false, message: 'Validation failed', errors: errors.array() }); } next(); }; const validateUser = [ body('username') .isLength({ min: 3, max: 30 }) .withMessage('Username must be between 3 and 30 characters'), body('email') .isEmail() .withMessage('Please provide a valid email'), body('password') .isLength({ min: 6 }) .withMessage('Password must be at least 6 characters'), body('firstName') .notEmpty() .withMessage('First name is required'), body('lastName') .notEmpty() .withMessage('Last name is required'), handleValidationErrors ]; const validateProduct = [ body('name') .notEmpty() .withMessage('Product name is required'), body('description') .notEmpty() .withMessage('Product description is required'), body('price') .isNumeric() .withMessage('Price must be a number'), body('category') .isIn(['electronics', 'clothing', 'books', 'home', 'sports']) .withMessage('Invalid category'), handleValidationErrors ]; module.exports = { validateUser, validateProduct, handleValidationErrors }; Routes 1. User Routes 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const express = require('express'); const router = express.Router(); const { protect, authorize } = require('../middleware/auth'); const { validateUser } = require('../middleware/validation'); const { registerUser, loginUser, getMe, getUsers } = require('../controllers/userController'); router.post('/register', validateUser, registerUser); router.post('/login', loginUser); router.get('/me', protect, getMe); router.get('/', protect, authorize('admin'), getUsers); module.exports = router; 2. Product Routes 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 const express = require('express'); const router = express.Router(); const { protect, authorize } = require('../middleware/auth'); const { validateProduct } = require('../middleware/validation'); const { getProducts, getProduct, createProduct } = require('../controllers/productController'); router.get('/', getProducts); router.get('/:id', getProduct); router.post('/', protect, validateProduct, createProduct); module.exports = router; Rate Limiting 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 const rateLimit = require('express-rate-limit'); const limiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 100, // limit each IP to 100 requests per windowMs message: { success: false, message: 'Too many requests from this IP, please try again later.' } }); const authLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 5, // limit each IP to 5 requests per windowMs message: { success: false, message: 'Too many authentication attempts, please try again later.' } }); module.exports = { limiter, authLimiter }; Testing API 1. Register User 1 2 3 4 5 6 7 8 9 curl -X POST http://localhost:3000/api/users/register \\ -H \"Content-Type: application/json\" \\ -d '{ \"username\": \"johndoe\", \"email\": \"john@example.com\", \"password\": \"password123\", \"firstName\": \"John\", \"lastName\": \"Doe\" }' 2. Login User 1 2 3 4 5 6 curl -X POST http://localhost:3000/api/users/login \\ -H \"Content-Type: application/json\" \\ -d '{ \"email\": \"john@example.com\", \"password\": \"password123\" }' 3. Get Products 1 curl -X GET \"http://localhost:3000/api/products?page=1\u0026limit=10\u0026category=electronics\" K·∫øt Lu·∫≠n V·ªõi Node.js v√† Express, b·∫°n c√≥ th·ªÉ x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v√† scalable. Nh·ªØng ki·∫øn th·ª©c n√†y bao g·ªìm:\nThi·∫øt l·∫≠p server v√† middleware K·∫øt n·ªëi database v·ªõi Mongoose Authentication v√† authorization Validation v√† error handling Rate limiting v√† security Pagination v√† filtering Trong b√†i vi·∫øt ti·∫øp theo, t√¥i s·∫Ω h∆∞·ªõng d·∫´n v·ªÅ testing v√† deployment! üöÄ\n","wordCount":"2781","inLanguage":"en","datePublished":"2024-01-10T13:30:00+07:00","dateModified":"2024-01-10T13:30:00+07:00","author":{"@type":"Person","name":"Thanh Tai"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-nodejs-express/"},"publisher":{"@type":"Organization","name":"My Programming Blog","logo":{"@type":"ImageObject","url":"https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/ accesskey=h title="My Programming Blog (Alt + H)">My Programming Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/ title="üè† Trang ch·ªß"><span>üè† Trang ch·ªß</span></a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/ title="üìù B√†i vi·∫øt"><span>üìù B√†i vi·∫øt</span></a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/about/ title="üëã Gi·ªõi thi·ªáu"><span>üëã Gi·ªõi thi·ªáu</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/>Home</a>&nbsp;¬ª&nbsp;<a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express</h1><div class=post-description>H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v·ªõi Node.js v√† Express framework</div><div class=post-meta></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#t·∫°i-sao-ch·ªçn-nodejs-v√†-express>T·∫°i Sao Ch·ªçn Node.js v√† Express?</a></li><li><a href=#thi·∫øt-l·∫≠p-d·ª±-√°n>Thi·∫øt L·∫≠p D·ª± √Ån</a><ul><li><a href=#1-kh·ªüi-t·∫°o-d·ª±-√°n>1. Kh·ªüi t·∫°o d·ª± √°n</a></li><li><a href=#2-c√†i-ƒë·∫∑t-dependencies>2. C√†i ƒë·∫∑t dependencies</a></li><li><a href=#3-c·∫•u-tr√∫c-th∆∞-m·ª•c>3. C·∫•u tr√∫c th∆∞ m·ª•c</a></li></ul></li><li><a href=#t·∫°o-server-c∆°-b·∫£n>T·∫°o Server C∆° B·∫£n</a><ul><li><a href=#1-serverjs>1. server.js</a></li><li><a href=#2-appjs>2. app.js</a></li></ul></li><li><a href=#k·∫øt-n·ªëi-database>K·∫øt N·ªëi Database</a><ul><li><a href=#1-configdatabasejs>1. config/database.js</a></li><li><a href=#2-env>2. .env</a></li></ul></li><li><a href=#t·∫°o-models>T·∫°o Models</a><ul><li><a href=#1-user-model>1. User Model</a></li><li><a href=#2-product-model>2. Product Model</a></li></ul></li><li><a href=#t·∫°o-controllers>T·∫°o Controllers</a><ul><li><a href=#1-user-controller>1. User Controller</a></li><li><a href=#2-product-controller>2. Product Controller</a></li></ul></li><li><a href=#middleware>Middleware</a><ul><li><a href=#1-authentication-middleware>1. Authentication Middleware</a></li><li><a href=#2-validation-middleware>2. Validation Middleware</a></li></ul></li><li><a href=#routes>Routes</a><ul><li><a href=#1-user-routes>1. User Routes</a></li><li><a href=#2-product-routes>2. Product Routes</a></li></ul></li><li><a href=#rate-limiting>Rate Limiting</a></li><li><a href=#testing-api>Testing API</a><ul><li><a href=#1-register-user>1. Register User</a></li><li><a href=#2-login-user>2. Login User</a></li><li><a href=#3-get-products>3. Get Products</a></li></ul></li><li><a href=#k·∫øt-lu·∫≠n>K·∫øt Lu·∫≠n</a></li></ul></nav></div></details></div><div class=post-content><h1 id=x√¢y-d·ª±ng-rest-api-v·ªõi-nodejs-v√†-express>X√¢y D·ª±ng REST API V·ªõi Node.js v√† Express<a hidden class=anchor aria-hidden=true href=#x√¢y-d·ª±ng-rest-api-v·ªõi-nodejs-v√†-express>#</a></h1><p>Node.js v√† Express l√† m·ªôt combo m·∫°nh m·∫Ω ƒë·ªÉ x√¢y d·ª±ng REST API. Trong b√†i vi·∫øt n√†y, t√¥i s·∫Ω h∆∞·ªõng d·∫´n b·∫°n c√°ch t·∫°o m·ªôt REST API ho√†n ch·ªânh t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.</p><h2 id=t·∫°i-sao-ch·ªçn-nodejs-v√†-express>T·∫°i Sao Ch·ªçn Node.js v√† Express?<a hidden class=anchor aria-hidden=true href=#t·∫°i-sao-ch·ªçn-nodejs-v√†-express>#</a></h2><ul><li><strong>JavaScript Everywhere</strong>: S·ª≠ d·ª•ng JavaScript cho c·∫£ frontend v√† backend</li><li><strong>NPM Ecosystem</strong>: Th∆∞ vi·ªán phong ph√∫ v√† c·ªông ƒë·ªìng l·ªõn</li><li><strong>Performance</strong>: Non-blocking I/O cho hi·ªáu su·∫•t cao</li><li><strong>Scalability</strong>: D·ªÖ d√†ng scale horizontal</li><li><strong>Rapid Development</strong>: Ph√°t tri·ªÉn nhanh ch√≥ng</li></ul><h2 id=thi·∫øt-l·∫≠p-d·ª±-√°n>Thi·∫øt L·∫≠p D·ª± √Ån<a hidden class=anchor aria-hidden=true href=#thi·∫øt-l·∫≠p-d·ª±-√°n>#</a></h2><h3 id=1-kh·ªüi-t·∫°o-d·ª±-√°n>1. Kh·ªüi t·∫°o d·ª± √°n<a hidden class=anchor aria-hidden=true href=#1-kh·ªüi-t·∫°o-d·ª±-√°n>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir my-api
</span></span><span class=line><span class=cl><span class=nb>cd</span> my-api
</span></span><span class=line><span class=cl>npm init -y
</span></span></code></pre></td></tr></table></div></div><h3 id=2-c√†i-ƒë·∫∑t-dependencies>2. C√†i ƒë·∫∑t dependencies<a hidden class=anchor aria-hidden=true href=#2-c√†i-ƒë·∫∑t-dependencies>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install express cors helmet morgan compression
</span></span><span class=line><span class=cl>npm install mongoose bcryptjs jsonwebtoken
</span></span><span class=line><span class=cl>npm install express-validator express-rate-limit
</span></span><span class=line><span class=cl>npm install dotenv
</span></span><span class=line><span class=cl>npm install -D nodemon
</span></span></code></pre></td></tr></table></div></div><h3 id=3-c·∫•u-tr√∫c-th∆∞-m·ª•c>3. C·∫•u tr√∫c th∆∞ m·ª•c<a hidden class=anchor aria-hidden=true href=#3-c·∫•u-tr√∫c-th∆∞-m·ª•c>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>my-api/
</span></span><span class=line><span class=cl>‚îú‚îÄ‚îÄ src/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ controllers/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ models/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ routes/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ middleware/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ utils/
</span></span><span class=line><span class=cl>‚îÇ   ‚îî‚îÄ‚îÄ app.js
</span></span><span class=line><span class=cl>‚îú‚îÄ‚îÄ config/
</span></span><span class=line><span class=cl>‚îÇ   ‚îî‚îÄ‚îÄ database.js
</span></span><span class=line><span class=cl>‚îú‚îÄ‚îÄ .env
</span></span><span class=line><span class=cl>‚îú‚îÄ‚îÄ package.json
</span></span><span class=line><span class=cl>‚îî‚îÄ‚îÄ server.js
</span></span></code></pre></td></tr></table></div></div><h2 id=t·∫°o-server-c∆°-b·∫£n>T·∫°o Server C∆° B·∫£n<a hidden class=anchor aria-hidden=true href=#t·∫°o-server-c∆°-b·∫£n>#</a></h2><h3 id=1-serverjs>1. server.js<a hidden class=anchor aria-hidden=true href=#1-serverjs>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cors</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cors&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>helmet</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;helmet&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>morgan</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;morgan&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>compression</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;compression&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./src/app&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Middleware
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>helmet</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cors</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>compression</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>morgan</span><span class=p>(</span><span class=s1>&#39;combined&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>limit</span><span class=o>:</span> <span class=s1>&#39;10mb&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Routes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/users&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./src/routes/userRoutes&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/products&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./src/routes/productRoutes&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Error handling middleware
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>((</span><span class=nx>err</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>stack</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Something went wrong!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;development&#39;</span> <span class=o>?</span> <span class=nx>err</span><span class=p>.</span><span class=nx>message</span> <span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 404 handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Route not found&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Server running on port </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-appjs>2. app.js<a hidden class=anchor aria-hidden=true href=#2-appjs>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Health check endpoint
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/health&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Server is running&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>app</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=k·∫øt-n·ªëi-database>K·∫øt N·ªëi Database<a hidden class=anchor aria-hidden=true href=#k·∫øt-n·ªëi-database>#</a></h2><h3 id=1-configdatabasejs>1. config/database.js<a hidden class=anchor aria-hidden=true href=#1-configdatabasejs>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>connectDB</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>conn</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MONGODB_URI</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>useNewUrlParser</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>useUnifiedTopology</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`MongoDB Connected: </span><span class=si>${</span><span class=nx>conn</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>host</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Database connection error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>connectDB</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-env>2. .env<a hidden class=anchor aria-hidden=true href=#2-env>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>NODE_ENV</span><span class=o>=</span>development
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>MONGODB_URI</span><span class=o>=</span>mongodb://localhost:27017/myapi
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET</span><span class=o>=</span>your-secret-key
</span></span><span class=line><span class=cl><span class=nv>JWT_EXPIRE</span><span class=o>=</span>7d
</span></span><span class=line><span class=cl><span class=nv>BCRYPT_ROUNDS</span><span class=o>=</span><span class=m>12</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=t·∫°o-models>T·∫°o Models<a hidden class=anchor aria-hidden=true href=#t·∫°o-models>#</a></h2><h3 id=1-user-model>1. User Model<a hidden class=anchor aria-hidden=true href=#1-user-model>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bcrypt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bcryptjs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>userSchema</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>username</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Username is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>trim</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>minlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=s1>&#39;Username must be at least 3 characters&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>maxlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>30</span><span class=p>,</span> <span class=s1>&#39;Username cannot exceed 30 characters&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Email is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>lowercase</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>match</span><span class=o>:</span> <span class=p>[</span><span class=sr>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/</span><span class=p>,</span> <span class=s1>&#39;Please enter a valid email&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Password is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>minlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=s1>&#39;Password must be at least 6 characters&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>select</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>firstName</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;First name is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>trim</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>maxlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>50</span><span class=p>,</span> <span class=s1>&#39;First name cannot exceed 50 characters&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>lastName</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Last name is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>trim</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>maxlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>50</span><span class=p>,</span> <span class=s1>&#39;Last name cannot exceed 50 characters&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>role</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kr>enum</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;moderator&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>isActive</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>lastLogin</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>Date</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamps</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Hash password before saving
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>userSchema</span><span class=p>.</span><span class=nx>pre</span><span class=p>(</span><span class=s1>&#39;save&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=kd>function</span><span class=p>(</span><span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>isModified</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>))</span> <span class=k>return</span> <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>password</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>password</span><span class=p>,</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>BCRYPT_ROUNDS</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Compare password method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>userSchema</span><span class=p>.</span><span class=nx>methods</span><span class=p>.</span><span class=nx>comparePassword</span> <span class=o>=</span> <span class=kr>async</span> <span class=kd>function</span><span class=p>(</span><span class=nx>candidatePassword</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span><span class=nx>candidatePassword</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Remove password from JSON output
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>userSchema</span><span class=p>.</span><span class=nx>methods</span><span class=p>.</span><span class=nx>toJSON</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userObject</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>toObject</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=nx>userObject</span><span class=p>.</span><span class=nx>password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>userObject</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>model</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=nx>userSchema</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-product-model>2. Product Model<a hidden class=anchor aria-hidden=true href=#2-product-model>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>productSchema</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Product name is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>trim</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>maxlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>100</span><span class=p>,</span> <span class=s1>&#39;Product name cannot exceed 100 characters&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>description</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Product description is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>maxlength</span><span class=o>:</span> <span class=p>[</span><span class=mi>500</span><span class=p>,</span> <span class=s1>&#39;Description cannot exceed 500 characters&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>price</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Product price is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>min</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Price cannot be negative&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>category</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Product category is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=kr>enum</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;electronics&#39;</span><span class=p>,</span> <span class=s1>&#39;clothing&#39;</span><span class=p>,</span> <span class=s1>&#39;books&#39;</span><span class=p>,</span> <span class=s1>&#39;home&#39;</span><span class=p>,</span> <span class=s1>&#39;sports&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>stock</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=kc>true</span><span class=p>,</span> <span class=s1>&#39;Stock quantity is required&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>min</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Stock cannot be negative&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>images</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>validate</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>validator</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=sr>/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid image URL&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=nx>tags</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>trim</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=nx>isActive</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>createdBy</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nx>Types</span><span class=p>.</span><span class=nx>ObjectId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>ref</span><span class=o>:</span> <span class=s1>&#39;User&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamps</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Index for search
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>productSchema</span><span class=p>.</span><span class=nx>index</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;text&#39;</span><span class=p>,</span> <span class=nx>description</span><span class=o>:</span> <span class=s1>&#39;text&#39;</span><span class=p>,</span> <span class=nx>tags</span><span class=o>:</span> <span class=s1>&#39;text&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>model</span><span class=p>(</span><span class=s1>&#39;Product&#39;</span><span class=p>,</span> <span class=nx>productSchema</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=t·∫°o-controllers>T·∫°o Controllers<a hidden class=anchor aria-hidden=true href=#t·∫°o-controllers>#</a></h2><h3 id=1-user-controller>1. User Controller<a hidden class=anchor aria-hidden=true href=#1-user-controller>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>User</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models/User&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Generate JWT Token
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>generateToken</span> <span class=o>=</span> <span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>id</span> <span class=p>},</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>expiresIn</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_EXPIRE</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Register user
</span></span></span><span class=line><span class=cl><span class=c1>// @route   POST /api/users/register
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Public
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>registerUser</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span><span class=p>,</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>password</span><span class=p>,</span> <span class=nx>firstName</span><span class=p>,</span> <span class=nx>lastName</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Check if user exists
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>existingUser</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>$or</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>email</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>username</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>existingUser</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;User already exists with this email or username&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Create user
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>firstName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>lastName</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>generateToken</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>_id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;User registered successfully&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>token</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error registering user&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Login user
</span></span></span><span class=line><span class=cl><span class=c1>// @route   POST /api/users/login
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Public
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>loginUser</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>password</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Check if user exists and include password
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span> <span class=nx>email</span> <span class=p>}).</span><span class=nx>select</span><span class=p>(</span><span class=s1>&#39;+password&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid credentials&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Check password
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>isPasswordValid</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>user</span><span class=p>.</span><span class=nx>comparePassword</span><span class=p>(</span><span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isPasswordValid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid credentials&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Update last login
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>user</span><span class=p>.</span><span class=nx>lastLogin</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>user</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>generateToken</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>_id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Login successful&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>token</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error logging in&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Get current user
</span></span></span><span class=line><span class=cl><span class=c1>// @route   GET /api/users/me
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Private
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>getMe</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error getting user profile&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Get all users
</span></span></span><span class=line><span class=cl><span class=c1>// @route   GET /api/users
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Private/Admin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>getUsers</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>page</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span> <span class=o>||</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>limit</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>limit</span><span class=p>)</span> <span class=o>||</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>skip</span> <span class=o>=</span> <span class=p>(</span><span class=nx>page</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=nx>limit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>find</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>select</span><span class=p>(</span><span class=s1>&#39;-password&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>skip</span><span class=p>(</span><span class=nx>skip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>limit</span><span class=p>(</span><span class=nx>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>sort</span><span class=p>({</span> <span class=nx>createdAt</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>total</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>countDocuments</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>users</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>pagination</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>page</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>limit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>pages</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span><span class=p>(</span><span class=nx>total</span> <span class=o>/</span> <span class=nx>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error getting users&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>registerUser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>loginUser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getMe</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getUsers</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-product-controller>2. Product Controller<a hidden class=anchor aria-hidden=true href=#2-product-controller>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Product</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models/Product&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Get all products
</span></span></span><span class=line><span class=cl><span class=c1>// @route   GET /api/products
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Public
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>getProducts</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>page</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span> <span class=o>||</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>limit</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>limit</span><span class=p>)</span> <span class=o>||</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>skip</span> <span class=o>=</span> <span class=p>(</span><span class=nx>page</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=nx>limit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>category</span><span class=p>,</span> <span class=nx>search</span><span class=p>,</span> <span class=nx>minPrice</span><span class=p>,</span> <span class=nx>maxPrice</span><span class=p>,</span> <span class=nx>sort</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Build filter object
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>filter</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>isActive</span><span class=o>:</span> <span class=kc>true</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>category</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>filter</span><span class=p>.</span><span class=nx>category</span> <span class=o>=</span> <span class=nx>category</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>search</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>filter</span><span class=p>.</span><span class=nx>$text</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>$search</span><span class=o>:</span> <span class=nx>search</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>minPrice</span> <span class=o>||</span> <span class=nx>maxPrice</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>filter</span><span class=p>.</span><span class=nx>price</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>minPrice</span><span class=p>)</span> <span class=nx>filter</span><span class=p>.</span><span class=nx>price</span><span class=p>.</span><span class=nx>$gte</span> <span class=o>=</span> <span class=nb>parseFloat</span><span class=p>(</span><span class=nx>minPrice</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>maxPrice</span><span class=p>)</span> <span class=nx>filter</span><span class=p>.</span><span class=nx>price</span><span class=p>.</span><span class=nx>$lte</span> <span class=o>=</span> <span class=nb>parseFloat</span><span class=p>(</span><span class=nx>maxPrice</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Build sort object
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>sortObj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>createdAt</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>sort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>switch</span> <span class=p>(</span><span class=nx>sort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;price-asc&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sortObj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>price</span><span class=o>:</span> <span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;price-desc&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sortObj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>price</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;name-asc&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sortObj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;name-desc&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sortObj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>products</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Product</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>filter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>populate</span><span class=p>(</span><span class=s1>&#39;createdBy&#39;</span><span class=p>,</span> <span class=s1>&#39;username firstName lastName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>skip</span><span class=p>(</span><span class=nx>skip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>limit</span><span class=p>(</span><span class=nx>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>sort</span><span class=p>(</span><span class=nx>sortObj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>total</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Product</span><span class=p>.</span><span class=nx>countDocuments</span><span class=p>(</span><span class=nx>filter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>products</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>pagination</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>page</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>limit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>pages</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span><span class=p>(</span><span class=nx>total</span> <span class=o>/</span> <span class=nx>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error getting products&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Get single product
</span></span></span><span class=line><span class=cl><span class=c1>// @route   GET /api/products/:id
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Public
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>getProduct</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>product</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Product</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>populate</span><span class=p>(</span><span class=s1>&#39;createdBy&#39;</span><span class=p>,</span> <span class=s1>&#39;username firstName lastName&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>product</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Product not found&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>product</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error getting product&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// @desc    Create product
</span></span></span><span class=line><span class=cl><span class=c1>// @route   POST /api/products
</span></span></span><span class=line><span class=cl><span class=c1>// @access  Private
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>createProduct</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>productData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>createdBy</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>product</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Product</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>productData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Product created successfully&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>product</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Error creating product&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getProducts</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getProduct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>createProduct</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=middleware>Middleware<a hidden class=anchor aria-hidden=true href=#middleware>#</a></h2><h3 id=1-authentication-middleware>1. Authentication Middleware<a hidden class=anchor aria-hidden=true href=#1-authentication-middleware>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>User</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models/User&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>protect</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;Bearer&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>token</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Access denied. No token provided.&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>decoded</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>decoded</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Token is not valid.&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>req</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Token is not valid.&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>authorize</span> <span class=o>=</span> <span class=p>(...</span><span class=nx>roles</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>roles</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=sb>`User role </span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=si>}</span><span class=sb> is not authorized to access this route`</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>authorize</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-validation-middleware>2. Validation Middleware<a hidden class=anchor aria-hidden=true href=#2-validation-middleware>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>validationResult</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express-validator&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleValidationErrors</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>errors</span> <span class=o>=</span> <span class=nx>validationResult</span><span class=p>(</span><span class=nx>req</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>errors</span><span class=p>.</span><span class=nx>isEmpty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Validation failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>errors</span><span class=o>:</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>array</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>validateUser</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>isLength</span><span class=p>({</span> <span class=nx>min</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>max</span><span class=o>:</span> <span class=mi>30</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Username must be between 3 and 30 characters&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>isEmail</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Please provide a valid email&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>isLength</span><span class=p>({</span> <span class=nx>min</span><span class=o>:</span> <span class=mi>6</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Password must be at least 6 characters&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;firstName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>notEmpty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;First name is required&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;lastName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>notEmpty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Last name is required&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>handleValidationErrors</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>validateProduct</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>notEmpty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Product name is required&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>notEmpty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Product description is required&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>isNumeric</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Price must be a number&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>isIn</span><span class=p>([</span><span class=s1>&#39;electronics&#39;</span><span class=p>,</span> <span class=s1>&#39;clothing&#39;</span><span class=p>,</span> <span class=s1>&#39;books&#39;</span><span class=p>,</span> <span class=s1>&#39;home&#39;</span><span class=p>,</span> <span class=s1>&#39;sports&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>withMessage</span><span class=p>(</span><span class=s1>&#39;Invalid category&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>handleValidationErrors</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>validateUser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>validateProduct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>handleValidationErrors</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=routes>Routes<a hidden class=anchor aria-hidden=true href=#routes>#</a></h2><h3 id=1-user-routes>1. User Routes<a hidden class=anchor aria-hidden=true href=#1-user-routes>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>authorize</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/auth&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>validateUser</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/validation&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>registerUser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>loginUser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getMe</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getUsers</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../controllers/userController&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=nx>validateUser</span><span class=p>,</span> <span class=nx>registerUser</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=nx>loginUser</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/me&#39;</span><span class=p>,</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>getMe</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>authorize</span><span class=p>(</span><span class=s1>&#39;admin&#39;</span><span class=p>),</span> <span class=nx>getUsers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-product-routes>2. Product Routes<a hidden class=anchor aria-hidden=true href=#2-product-routes>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>authorize</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/auth&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>validateProduct</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/validation&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getProducts</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>getProduct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>createProduct</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../controllers/productController&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>getProducts</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/:id&#39;</span><span class=p>,</span> <span class=nx>getProduct</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>protect</span><span class=p>,</span> <span class=nx>validateProduct</span><span class=p>,</span> <span class=nx>createProduct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=rate-limiting>Rate Limiting<a hidden class=anchor aria-hidden=true href=#rate-limiting>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>rateLimit</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express-rate-limit&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>limiter</span> <span class=o>=</span> <span class=nx>rateLimit</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>windowMs</span><span class=o>:</span> <span class=mi>15</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 15 minutes
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>max</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=c1>// limit each IP to 100 requests per windowMs
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Too many requests from this IP, please try again later.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>authLimiter</span> <span class=o>=</span> <span class=nx>rateLimit</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>windowMs</span><span class=o>:</span> <span class=mi>15</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 15 minutes
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>max</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=c1>// limit each IP to 5 requests per windowMs
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Too many authentication attempts, please try again later.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>limiter</span><span class=p>,</span> <span class=nx>authLimiter</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=testing-api>Testing API<a hidden class=anchor aria-hidden=true href=#testing-api>#</a></h2><h3 id=1-register-user>1. Register User<a hidden class=anchor aria-hidden=true href=#1-register-user>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X POST http://localhost:3000/api/users/register <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;username&#34;: &#34;johndoe&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;email&#34;: &#34;john@example.com&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;password&#34;: &#34;password123&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;firstName&#34;: &#34;John&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;lastName&#34;: &#34;Doe&#34;
</span></span></span><span class=line><span class=cl><span class=s1>  }&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-login-user>2. Login User<a hidden class=anchor aria-hidden=true href=#2-login-user>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X POST http://localhost:3000/api/users/login <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;email&#34;: &#34;john@example.com&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;password&#34;: &#34;password123&#34;
</span></span></span><span class=line><span class=cl><span class=s1>  }&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-get-products>3. Get Products<a hidden class=anchor aria-hidden=true href=#3-get-products>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X GET <span class=s2>&#34;http://localhost:3000/api/products?page=1&amp;limit=10&amp;category=electronics&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=k·∫øt-lu·∫≠n>K·∫øt Lu·∫≠n<a hidden class=anchor aria-hidden=true href=#k·∫øt-lu·∫≠n>#</a></h2><p>V·ªõi Node.js v√† Express, b·∫°n c√≥ th·ªÉ x√¢y d·ª±ng REST API m·∫°nh m·∫Ω v√† scalable. Nh·ªØng ki·∫øn th·ª©c n√†y bao g·ªìm:</p><ul><li>Thi·∫øt l·∫≠p server v√† middleware</li><li>K·∫øt n·ªëi database v·ªõi Mongoose</li><li>Authentication v√† authorization</li><li>Validation v√† error handling</li><li>Rate limiting v√† security</li><li>Pagination v√† filtering</li></ul><p>Trong b√†i vi·∫øt ti·∫øp theo, t√¥i s·∫Ω h∆∞·ªõng d·∫´n v·ªÅ testing v√† deployment! üöÄ</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/javascript/>Javascript</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/nodejs/>Nodejs</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/express/>Express</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/api/>Api</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/backend/>Backend</a></li></ul><nav class=paginav><a class=prev href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/javascript-tips-2024/><span class=title>¬´ Prev</span><br><span>10 JavaScript Tips H·ªØu √çch Cho NƒÉm 2024</span>
</a><a class=next href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-data-jpa/><span class=title>Next ¬ª</span><br><span>Spring Data JPA - L√†m Vi·ªác V·ªõi Database Hi·ªáu Qu·∫£</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/>My Programming Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>