<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Testing trong Spring Boot - Unit Test và Integration Test | My Programming Blog</title><meta name=keywords content="java,spring-boot,testing,junit,mockito"><meta name=description content="Hướng dẫn chi tiết về testing trong Spring Boot từ unit test đến integration test"><meta name=author content="Thanh Tai"><link rel=canonical href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-boot-testing/><link crossorigin=anonymous href=/my-programming-blog/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as=style><link rel=icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon-32x32.png><link rel=apple-touch-icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/apple-touch-icon.png><link rel=mask-icon href=https://nguyenthanhluan09060024.github.io/my-programming-blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-boot-testing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-boot-testing/"><meta property="og:site_name" content="My Programming Blog"><meta property="og:title" content="Testing trong Spring Boot - Unit Test và Integration Test"><meta property="og:description" content="Hướng dẫn chi tiết về testing trong Spring Boot từ unit test đến integration test"><meta property="og:locale" content="vi"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-04T08:30:00+07:00"><meta property="article:modified_time" content="2024-01-04T08:30:00+07:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring-Boot"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Junit"><meta property="article:tag" content="Mockito"><meta name=twitter:card content="summary"><meta name=twitter:title content="Testing trong Spring Boot - Unit Test và Integration Test"><meta name=twitter:description content="Hướng dẫn chi tiết về testing trong Spring Boot từ unit test đến integration test"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/"},{"@type":"ListItem","position":2,"name":"Testing trong Spring Boot - Unit Test và Integration Test","item":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-boot-testing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Testing trong Spring Boot - Unit Test và Integration Test","name":"Testing trong Spring Boot - Unit Test và Integration Test","description":"Hướng dẫn chi tiết về testing trong Spring Boot từ unit test đến integration test","keywords":["java","spring-boot","testing","junit","mockito"],"articleBody":"Testing trong Spring Boot - Unit Test và Integration Test Testing là một phần quan trọng trong phát triển phần mềm. Spring Boot cung cấp các công cụ mạnh mẽ để viết unit test và integration test. Trong bài viết này, tôi sẽ hướng dẫn bạn cách testing hiệu quả.\nTại Sao Cần Testing? Quality Assurance: Đảm bảo chất lượng code Regression Prevention: Ngăn chặn lỗi khi thay đổi code Documentation: Test cases là tài liệu sống Confidence: Tự tin khi refactor code CI/CD: Tích hợp vào quy trình deployment Dependencies cho Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 org.springframework.boot spring-boot-starter-test test org.testcontainers junit-jupiter test org.testcontainers mysql test Unit Testing 1. Service Layer Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 @ExtendWith(MockitoExtension.class) class UserServiceTest { @Mock private UserRepository userRepository; @Mock private PasswordEncoder passwordEncoder; @InjectMocks private UserService userService; @Test void shouldCreateUserSuccessfully() { // Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"johndoe\"); request.setEmail(\"john@example.com\"); request.setPassword(\"password123\"); request.setFirstName(\"John\"); request.setLastName(\"Doe\"); User savedUser = new User(); savedUser.setId(1L); savedUser.setUsername(\"johndoe\"); savedUser.setEmail(\"john@example.com\"); when(userRepository.existsByUsername(\"johndoe\")).thenReturn(false); when(userRepository.existsByEmail(\"john@example.com\")).thenReturn(false); when(passwordEncoder.encode(\"password123\")).thenReturn(\"encodedPassword\"); when(userRepository.save(any(User.class))).thenReturn(savedUser); // When User result = userService.createUser(request); // Then assertThat(result).isNotNull(); assertThat(result.getUsername()).isEqualTo(\"johndoe\"); assertThat(result.getEmail()).isEqualTo(\"john@example.com\"); verify(userRepository).existsByUsername(\"johndoe\"); verify(userRepository).existsByEmail(\"john@example.com\"); verify(passwordEncoder).encode(\"password123\"); verify(userRepository).save(any(User.class)); } @Test void shouldThrowExceptionWhenUsernameExists() { // Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"johndoe\"); request.setEmail(\"john@example.com\"); request.setPassword(\"password123\"); request.setFirstName(\"John\"); request.setLastName(\"Doe\"); when(userRepository.existsByUsername(\"johndoe\")).thenReturn(true); // When \u0026 Then assertThatThrownBy(() -\u003e userService.createUser(request)) .isInstanceOf(RuntimeException.class) .hasMessage(\"Username already exists\"); verify(userRepository).existsByUsername(\"johndoe\"); verify(userRepository, never()).save(any(User.class)); } @Test void shouldGetUserById() { // Given Long userId = 1L; User user = new User(); user.setId(userId); user.setUsername(\"johndoe\"); user.setEmail(\"john@example.com\"); when(userRepository.findById(userId)).thenReturn(Optional.of(user)); // When Optional\u003cUser\u003e result = userService.getUserById(userId); // Then assertThat(result).isPresent(); assertThat(result.get().getUsername()).isEqualTo(\"johndoe\"); verify(userRepository).findById(userId); } @Test void shouldReturnEmptyWhenUserNotFound() { // Given Long userId = 1L; when(userRepository.findById(userId)).thenReturn(Optional.empty()); // When Optional\u003cUser\u003e result = userService.getUserById(userId); // Then assertThat(result).isEmpty(); verify(userRepository).findById(userId); } } 2. Controller Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 @WebMvcTest(UserController.class) class UserControllerTest { @Autowired private MockMvc mockMvc; @MockBean private UserService userService; @Autowired private ObjectMapper objectMapper; @Test void shouldCreateUserSuccessfully() throws Exception { // Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"johndoe\"); request.setEmail(\"john@example.com\"); request.setPassword(\"password123\"); request.setFirstName(\"John\"); request.setLastName(\"Doe\"); User user = new User(); user.setId(1L); user.setUsername(\"johndoe\"); user.setEmail(\"john@example.com\"); when(userService.createUser(any(CreateUserRequest.class))).thenReturn(user); // When \u0026 Then mockMvc.perform(post(\"/api/users\") .contentType(MediaType.APPLICATION_JSON) .content(objectMapper.writeValueAsString(request))) .andExpect(status().isCreated()) .andExpect(jsonPath(\"$.success\").value(true)) .andExpect(jsonPath(\"$.data.username\").value(\"johndoe\")) .andExpect(jsonPath(\"$.data.email\").value(\"john@example.com\")); verify(userService).createUser(any(CreateUserRequest.class)); } @Test void shouldReturnBadRequestWhenValidationFails() throws Exception { // Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"\"); // Invalid username request.setEmail(\"invalid-email\"); // Invalid email request.setPassword(\"123\"); // Too short password // When \u0026 Then mockMvc.perform(post(\"/api/users\") .contentType(MediaType.APPLICATION_JSON) .content(objectMapper.writeValueAsString(request))) .andExpect(status().isBadRequest()) .andExpect(jsonPath(\"$.success\").value(false)); verify(userService, never()).createUser(any(CreateUserRequest.class)); } @Test void shouldGetUserById() throws Exception { // Given Long userId = 1L; User user = new User(); user.setId(userId); user.setUsername(\"johndoe\"); user.setEmail(\"john@example.com\"); when(userService.getUserById(userId)).thenReturn(Optional.of(user)); // When \u0026 Then mockMvc.perform(get(\"/api/users/{id}\", userId)) .andExpect(status().isOk()) .andExpect(jsonPath(\"$.success\").value(true)) .andExpect(jsonPath(\"$.data.username\").value(\"johndoe\")) .andExpect(jsonPath(\"$.data.email\").value(\"john@example.com\")); verify(userService).getUserById(userId); } @Test void shouldReturnNotFoundWhenUserDoesNotExist() throws Exception { // Given Long userId = 1L; when(userService.getUserById(userId)).thenReturn(Optional.empty()); // When \u0026 Then mockMvc.perform(get(\"/api/users/{id}\", userId)) .andExpect(status().isNotFound()); verify(userService).getUserById(userId); } } Integration Testing 1. Repository Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 @DataJpaTest class UserRepositoryTest { @Autowired private TestEntityManager entityManager; @Autowired private UserRepository userRepository; @Test void shouldFindUserByUsername() { // Given User user = new User(); user.setUsername(\"johndoe\"); user.setEmail(\"john@example.com\"); user.setPassword(\"password123\"); user.setFirstName(\"John\"); user.setLastName(\"Doe\"); entityManager.persistAndFlush(user); // When Optional\u003cUser\u003e found = userRepository.findByUsername(\"johndoe\"); // Then assertThat(found).isPresent(); assertThat(found.get().getUsername()).isEqualTo(\"johndoe\"); } @Test void shouldFindUsersByStatus() { // Given User activeUser = new User(); activeUser.setUsername(\"activeuser\"); activeUser.setEmail(\"active@example.com\"); activeUser.setPassword(\"password123\"); activeUser.setFirstName(\"Active\"); activeUser.setLastName(\"User\"); activeUser.setStatus(UserStatus.ACTIVE); User inactiveUser = new User(); inactiveUser.setUsername(\"inactiveuser\"); inactiveUser.setEmail(\"inactive@example.com\"); inactiveUser.setPassword(\"password123\"); inactiveUser.setFirstName(\"Inactive\"); inactiveUser.setLastName(\"User\"); inactiveUser.setStatus(UserStatus.INACTIVE); entityManager.persistAndFlush(activeUser); entityManager.persistAndFlush(inactiveUser); // When List\u003cUser\u003e activeUsers = userRepository.findByStatus(UserStatus.ACTIVE); // Then assertThat(activeUsers).hasSize(1); assertThat(activeUsers.get(0).getStatus()).isEqualTo(UserStatus.ACTIVE); } } 2. Full Integration Test 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) @Testcontainers class UserControllerIntegrationTest { @Container static MySQLContainer\u003c?\u003e mysql = new MySQLContainer\u003c\u003e(\"mysql:8.0\") .withDatabaseName(\"testdb\") .withUsername(\"test\") .withPassword(\"test\"); @Autowired private TestRestTemplate restTemplate; @Autowired private UserRepository userRepository; @DynamicPropertySource static void configureProperties(DynamicPropertyRegistry registry) { registry.add(\"spring.datasource.url\", mysql::getJdbcUrl); registry.add(\"spring.datasource.username\", mysql::getUsername); registry.add(\"spring.datasource.password\", mysql::getPassword); } @BeforeEach void setUp() { userRepository.deleteAll(); } @Test void shouldCreateAndRetrieveUser() { // Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"johndoe\"); request.setEmail(\"john@example.com\"); request.setPassword(\"password123\"); request.setFirstName(\"John\"); request.setLastName(\"Doe\"); // When ResponseEntity\u003cApiResponse\u003cUser\u003e\u003e createResponse = restTemplate.postForEntity( \"/api/users\", request, new ParameterizedTypeReference\u003cApiResponse\u003cUser\u003e\u003e() {} ); // Then assertThat(createResponse.getStatusCode()).isEqualTo(HttpStatus.CREATED); assertThat(createResponse.getBody().getSuccess()).isTrue(); assertThat(createResponse.getBody().getData().getUsername()).isEqualTo(\"johndoe\"); // When - Get user Long userId = createResponse.getBody().getData().getId(); ResponseEntity\u003cApiResponse\u003cUser\u003e\u003e getResponse = restTemplate.getForEntity( \"/api/users/\" + userId, new ParameterizedTypeReference\u003cApiResponse\u003cUser\u003e\u003e() {} ); // Then assertThat(getResponse.getStatusCode()).isEqualTo(HttpStatus.OK); assertThat(getResponse.getBody().getData().getUsername()).isEqualTo(\"johndoe\"); } @Test void shouldReturnAllUsers() { // Given User user1 = new User(); user1.setUsername(\"user1\"); user1.setEmail(\"user1@example.com\"); user1.setPassword(\"password123\"); user1.setFirstName(\"User\"); user1.setLastName(\"One\"); User user2 = new User(); user2.setUsername(\"user2\"); user2.setEmail(\"user2@example.com\"); user2.setPassword(\"password123\"); user2.setFirstName(\"User\"); user2.setLastName(\"Two\"); userRepository.saveAll(Arrays.asList(user1, user2)); // When ResponseEntity\u003cApiResponse\u003cList\u003cUser\u003e\u003e\u003e response = restTemplate.exchange( \"/api/users\", HttpMethod.GET, null, new ParameterizedTypeReference\u003cApiResponse\u003cList\u003cUser\u003e\u003e\u003e() {} ); // Then assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK); assertThat(response.getBody().getData()).hasSize(2); } } Testing với TestContainers 1. Database Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @SpringBootTest @Testcontainers class DatabaseIntegrationTest { @Container static MySQLContainer\u003c?\u003e mysql = new MySQLContainer\u003c\u003e(\"mysql:8.0\") .withDatabaseName(\"testdb\") .withUsername(\"test\") .withPassword(\"test\"); @DynamicPropertySource static void configureProperties(DynamicPropertyRegistry registry) { registry.add(\"spring.datasource.url\", mysql::getJdbcUrl); registry.add(\"spring.datasource.username\", mysql::getUsername); registry.add(\"spring.datasource.password\", mysql::getPassword); } @Test void shouldConnectToDatabase() { // Test database connection assertThat(mysql.isRunning()).isTrue(); } } 2. Redis Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @SpringBootTest @Testcontainers class RedisIntegrationTest { @Container static GenericContainer\u003c?\u003e redis = new GenericContainer\u003c\u003e(\"redis:7-alpine\") .withExposedPorts(6379); @DynamicPropertySource static void configureProperties(DynamicPropertyRegistry registry) { registry.add(\"spring.redis.host\", redis::getHost); registry.add(\"spring.redis.port\", () -\u003e redis.getMappedPort(6379)); } @Test void shouldConnectToRedis() { assertThat(redis.isRunning()).isTrue(); } } Testing Configuration 1. Test Configuration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @TestConfiguration public class TestConfig { @Bean @Primary public PasswordEncoder testPasswordEncoder() { return new BCryptPasswordEncoder(); } @Bean @Primary public Clock testClock() { return Clock.fixed(Instant.parse(\"2024-01-01T00:00:00Z\"), ZoneOffset.UTC); } } 2. Test Properties 1 2 3 4 5 6 # application-test.properties spring.datasource.url=jdbc:h2:mem:testdb spring.datasource.driver-class-name=org.h2.Driver spring.jpa.hibernate.ddl-auto=create-drop spring.jpa.show-sql=true logging.level.org.springframework.web=DEBUG Performance Testing 1. Load Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) class PerformanceTest { @Autowired private TestRestTemplate restTemplate; @Test void shouldHandleConcurrentRequests() throws InterruptedException { int numberOfThreads = 10; int requestsPerThread = 100; CountDownLatch latch = new CountDownLatch(numberOfThreads); AtomicInteger successCount = new AtomicInteger(0); AtomicInteger errorCount = new AtomicInteger(0); for (int i = 0; i \u003c numberOfThreads; i++) { new Thread(() -\u003e { try { for (int j = 0; j \u003c requestsPerThread; j++) { try { ResponseEntity\u003cString\u003e response = restTemplate.getForEntity( \"/api/users\", String.class); if (response.getStatusCode().is2xxSuccessful()) { successCount.incrementAndGet(); } else { errorCount.incrementAndGet(); } } catch (Exception e) { errorCount.incrementAndGet(); } } } finally { latch.countDown(); } }).start(); } latch.await(30, TimeUnit.SECONDS); int totalRequests = numberOfThreads * requestsPerThread; assertThat(successCount.get()).isGreaterThan(totalRequests * 0.9); // 90% success rate assertThat(errorCount.get()).isLessThan(totalRequests * 0.1); // Less than 10% errors } } Test Coverage 1. JaCoCo Configuration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 org.jacoco jacoco-maven-plugin 0.8.8 prepare-agent report test report 2. Coverage Goals 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 org.jacoco jacoco-maven-plugin BUNDLE LINE COVEREDRATIO 0.80 Best Practices 1. Test Naming 1 2 3 4 5 6 7 8 9 10 11 12 13 // ✅ Good naming @Test void shouldReturnUserWhenValidIdProvided() { } @Test void shouldThrowExceptionWhenUserNotFound() { } // ❌ Bad naming @Test void test1() { } @Test void testUser() { } 2. Test Structure (AAA Pattern) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Test void shouldCreateUserSuccessfully() { // Arrange - Given CreateUserRequest request = new CreateUserRequest(); request.setUsername(\"johndoe\"); // ... setup data when(userRepository.existsByUsername(\"johndoe\")).thenReturn(false); // ... setup mocks // Act - When User result = userService.createUser(request); // Assert - Then assertThat(result).isNotNull(); assertThat(result.getUsername()).isEqualTo(\"johndoe\"); // ... verify results } 3. Test Isolation 1 2 3 4 5 6 7 8 @BeforeEach void setUp() { // Reset mocks reset(userRepository, passwordEncoder); // Clear database userRepository.deleteAll(); } Kết Luận Testing trong Spring Boot cung cấp một bộ công cụ mạnh mẽ để đảm bảo chất lượng code. Với những kiến thức này, bạn có thể:\nViết unit test hiệu quả với Mockito Thực hiện integration test với TestContainers Test performance và load Đo lường test coverage Áp dụng best practices Trong bài viết tiếp theo, tôi sẽ hướng dẫn về Docker và deployment! 🚀\n","wordCount":"1654","inLanguage":"en","datePublished":"2024-01-04T08:30:00+07:00","dateModified":"2024-01-04T08:30:00+07:00","author":{"@type":"Person","name":"Thanh Tai"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/java-spring-boot-testing/"},"publisher":{"@type":"Organization","name":"My Programming Blog","logo":{"@type":"ImageObject","url":"https://nguyenthanhluan09060024.github.io/my-programming-blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/ accesskey=h title="My Programming Blog (Alt + H)">My Programming Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/ title="🏠 Trang chủ"><span>🏠 Trang chủ</span></a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/ title="📝 Bài viết"><span>📝 Bài viết</span></a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/about/ title="👋 Giới thiệu"><span>👋 Giới thiệu</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/>Home</a>&nbsp;»&nbsp;<a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Testing trong Spring Boot - Unit Test và Integration Test</h1><div class=post-description>Hướng dẫn chi tiết về testing trong Spring Boot từ unit test đến integration test</div><div class=post-meta></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#tại-sao-cần-testing>Tại Sao Cần Testing?</a></li><li><a href=#dependencies-cho-testing>Dependencies cho Testing</a></li><li><a href=#unit-testing>Unit Testing</a><ul><li><a href=#1-service-layer-testing>1. Service Layer Testing</a></li><li><a href=#2-controller-testing>2. Controller Testing</a></li></ul></li><li><a href=#integration-testing>Integration Testing</a><ul><li><a href=#1-repository-testing>1. Repository Testing</a></li><li><a href=#2-full-integration-test>2. Full Integration Test</a></li></ul></li><li><a href=#testing-với-testcontainers>Testing với TestContainers</a><ul><li><a href=#1-database-testing>1. Database Testing</a></li><li><a href=#2-redis-testing>2. Redis Testing</a></li></ul></li><li><a href=#testing-configuration>Testing Configuration</a><ul><li><a href=#1-test-configuration>1. Test Configuration</a></li><li><a href=#2-test-properties>2. Test Properties</a></li></ul></li><li><a href=#performance-testing>Performance Testing</a><ul><li><a href=#1-load-testing>1. Load Testing</a></li></ul></li><li><a href=#test-coverage>Test Coverage</a><ul><li><a href=#1-jacoco-configuration>1. JaCoCo Configuration</a></li><li><a href=#2-coverage-goals>2. Coverage Goals</a></li></ul></li><li><a href=#best-practices>Best Practices</a><ul><li><a href=#1-test-naming>1. Test Naming</a></li><li><a href=#2-test-structure-aaa-pattern>2. Test Structure (AAA Pattern)</a></li><li><a href=#3-test-isolation>3. Test Isolation</a></li></ul></li><li><a href=#kết-luận>Kết Luận</a></li></ul></nav></div></details></div><div class=post-content><h1 id=testing-trong-spring-boot---unit-test-và-integration-test>Testing trong Spring Boot - Unit Test và Integration Test<a hidden class=anchor aria-hidden=true href=#testing-trong-spring-boot---unit-test-và-integration-test>#</a></h1><p>Testing là một phần quan trọng trong phát triển phần mềm. Spring Boot cung cấp các công cụ mạnh mẽ để viết unit test và integration test. Trong bài viết này, tôi sẽ hướng dẫn bạn cách testing hiệu quả.</p><h2 id=tại-sao-cần-testing>Tại Sao Cần Testing?<a hidden class=anchor aria-hidden=true href=#tại-sao-cần-testing>#</a></h2><ul><li><strong>Quality Assurance</strong>: Đảm bảo chất lượng code</li><li><strong>Regression Prevention</strong>: Ngăn chặn lỗi khi thay đổi code</li><li><strong>Documentation</strong>: Test cases là tài liệu sống</li><li><strong>Confidence</strong>: Tự tin khi refactor code</li><li><strong>CI/CD</strong>: Tích hợp vào quy trình deployment</li></ul><h2 id=dependencies-cho-testing>Dependencies cho Testing<a hidden class=anchor aria-hidden=true href=#dependencies-cho-testing>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>junit-jupiter<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>mysql<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=unit-testing>Unit Testing<a hidden class=anchor aria-hidden=true href=#unit-testing>#</a></h2><h3 id=1-service-layer-testing>1. Service Layer Testing<a hidden class=anchor aria-hidden=true href=#1-service-layer-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ExtendWith</span><span class=p>(</span><span class=n>MockitoExtension</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>UserServiceTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Mock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Mock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@InjectMocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldCreateUserSuccessfully</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;John&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Doe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>savedUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>savedUser</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>1L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>savedUser</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>savedUser</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>existsByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>existsByEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>.</span><span class=na>encode</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=s>&#34;encodedPassword&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>))).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>savedUser</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>isNotNull</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getEmail</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>existsByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>existsByEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>).</span><span class=na>encode</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>save</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldThrowExceptionWhenUsernameExists</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;John&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Doe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>existsByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThatThrownBy</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>request</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>isInstanceOf</span><span class=p>(</span><span class=n>RuntimeException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>hasMessage</span><span class=p>(</span><span class=s>&#34;Username already exists&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>existsByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>,</span><span class=w> </span><span class=n>never</span><span class=p>()).</span><span class=na>save</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldGetUserById</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>userId</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>user</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>isPresent</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>get</span><span class=p>().</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>findById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldReturnEmptyWhenUserNotFound</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>userId</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>empty</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>isEmpty</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userRepository</span><span class=p>).</span><span class=na>findById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-controller-testing>2. Controller Testing<a hidden class=anchor aria-hidden=true href=#2-controller-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@WebMvcTest</span><span class=p>(</span><span class=n>UserController</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>UserControllerTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@MockBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldCreateUserSuccessfully</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;John&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Doe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>1L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userService</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>CreateUserRequest</span><span class=p>.</span><span class=na>class</span><span class=p>))).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/api/users&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>content</span><span class=p>(</span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>request</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isCreated</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.success&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=kc>true</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.username&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.email&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userService</span><span class=p>).</span><span class=na>createUser</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>CreateUserRequest</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldReturnBadRequestWhenValidationFails</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// Invalid username</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;invalid-email&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// Invalid email</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;123&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// Too short password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/api/users&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>content</span><span class=p>(</span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>request</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isBadRequest</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.success&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=kc>false</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userService</span><span class=p>,</span><span class=w> </span><span class=n>never</span><span class=p>()).</span><span class=na>createUser</span><span class=p>(</span><span class=n>any</span><span class=p>(</span><span class=n>CreateUserRequest</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldGetUserById</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userService</span><span class=p>.</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>user</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/api/users/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.success&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=kc>true</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.username&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.email&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userService</span><span class=p>).</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldReturnNotFoundWhenUserDoesNotExist</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>userService</span><span class=p>.</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>empty</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/api/users/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isNotFound</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>userService</span><span class=p>).</span><span class=na>getUserById</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=integration-testing>Integration Testing<a hidden class=anchor aria-hidden=true href=#integration-testing>#</a></h2><h3 id=1-repository-testing>1. Repository Testing<a hidden class=anchor aria-hidden=true href=#1-repository-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@DataJpaTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>UserRepositoryTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TestEntityManager</span><span class=w> </span><span class=n>entityManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldFindUserByUsername</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;John&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Doe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entityManager</span><span class=p>.</span><span class=na>persistAndFlush</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>found</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>findByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>found</span><span class=p>).</span><span class=na>isPresent</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>found</span><span class=p>.</span><span class=na>get</span><span class=p>().</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldFindUsersByStatus</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>activeUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;activeuser&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;active@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;Active&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>activeUser</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>UserStatus</span><span class=p>.</span><span class=na>ACTIVE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>inactiveUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;inactiveuser&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;inactive@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;Inactive&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>inactiveUser</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>UserStatus</span><span class=p>.</span><span class=na>INACTIVE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entityManager</span><span class=p>.</span><span class=na>persistAndFlush</span><span class=p>(</span><span class=n>activeUser</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entityManager</span><span class=p>.</span><span class=na>persistAndFlush</span><span class=p>(</span><span class=n>inactiveUser</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>activeUsers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>findByStatus</span><span class=p>(</span><span class=n>UserStatus</span><span class=p>.</span><span class=na>ACTIVE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>activeUsers</span><span class=p>).</span><span class=na>hasSize</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>activeUsers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getStatus</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>UserStatus</span><span class=p>.</span><span class=na>ACTIVE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-full-integration-test>2. Full Integration Test<a hidden class=anchor aria-hidden=true href=#2-full-integration-test>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Testcontainers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>UserControllerIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>MySQLContainer</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MySQLContainer</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=s>&#34;mysql:8.0&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withDatabaseName</span><span class=p>(</span><span class=s>&#34;testdb&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withUsername</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withPassword</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TestRestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DynamicPropertySource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configureProperties</span><span class=p>(</span><span class=n>DynamicPropertyRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.url&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getJdbcUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getUsername</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getPassword</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@BeforeEach</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>setUp</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userRepository</span><span class=p>.</span><span class=na>deleteAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldCreateAndRetrieveUser</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;john@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;John&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Doe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>createResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;/api/users&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ParameterizedTypeReference</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>createResponse</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>createResponse</span><span class=p>.</span><span class=na>getBody</span><span class=p>().</span><span class=na>getSuccess</span><span class=p>()).</span><span class=na>isTrue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>createResponse</span><span class=p>.</span><span class=na>getBody</span><span class=p>().</span><span class=na>getData</span><span class=p>().</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When - Get user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createResponse</span><span class=p>.</span><span class=na>getBody</span><span class=p>().</span><span class=na>getData</span><span class=p>().</span><span class=na>getId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>getResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForEntity</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;/api/users/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ParameterizedTypeReference</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>getResponse</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>getResponse</span><span class=p>.</span><span class=na>getBody</span><span class=p>().</span><span class=na>getData</span><span class=p>().</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldReturnAllUsers</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user1</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user1</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;user1@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user1</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user1</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user1</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;One&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user2</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user2</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;user2@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user2</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password123&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user2</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>&#34;User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user2</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>&#34;Two&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userRepository</span><span class=p>.</span><span class=na>saveAll</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>user2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>exchange</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;/api/users&#34;</span><span class=p>,</span><span class=w> </span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>GET</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>ParameterizedTypeReference</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getBody</span><span class=p>().</span><span class=na>getData</span><span class=p>()).</span><span class=na>hasSize</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=testing-với-testcontainers>Testing với TestContainers<a hidden class=anchor aria-hidden=true href=#testing-với-testcontainers>#</a></h2><h3 id=1-database-testing>1. Database Testing<a hidden class=anchor aria-hidden=true href=#1-database-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Testcontainers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>DatabaseIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>MySQLContainer</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MySQLContainer</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=s>&#34;mysql:8.0&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withDatabaseName</span><span class=p>(</span><span class=s>&#34;testdb&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withUsername</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withPassword</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DynamicPropertySource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configureProperties</span><span class=p>(</span><span class=n>DynamicPropertyRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.url&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getJdbcUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getUsername</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.datasource.password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mysql</span><span class=p>::</span><span class=n>getPassword</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldConnectToDatabase</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Test database connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>mysql</span><span class=p>.</span><span class=na>isRunning</span><span class=p>()).</span><span class=na>isTrue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-redis-testing>2. Redis Testing<a hidden class=anchor aria-hidden=true href=#2-redis-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Testcontainers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>RedisIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>GenericContainer</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>redis</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>GenericContainer</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=s>&#34;redis:7-alpine&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExposedPorts</span><span class=p>(</span><span class=n>6379</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DynamicPropertySource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configureProperties</span><span class=p>(</span><span class=n>DynamicPropertyRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.redis.host&#34;</span><span class=p>,</span><span class=w> </span><span class=n>redis</span><span class=p>::</span><span class=n>getHost</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;spring.redis.port&#34;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>redis</span><span class=p>.</span><span class=na>getMappedPort</span><span class=p>(</span><span class=n>6379</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldConnectToRedis</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>redis</span><span class=p>.</span><span class=na>isRunning</span><span class=p>()).</span><span class=na>isTrue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=testing-configuration>Testing Configuration<a hidden class=anchor aria-hidden=true href=#testing-configuration>#</a></h2><h3 id=1-test-configuration>1. Test Configuration<a hidden class=anchor aria-hidden=true href=#1-test-configuration>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@TestConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TestConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Primary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=nf>testPasswordEncoder</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BCryptPasswordEncoder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Primary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Clock</span><span class=w> </span><span class=nf>testClock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Clock</span><span class=p>.</span><span class=na>fixed</span><span class=p>(</span><span class=n>Instant</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=s>&#34;2024-01-01T00:00:00Z&#34;</span><span class=p>),</span><span class=w> </span><span class=n>ZoneOffset</span><span class=p>.</span><span class=na>UTC</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-test-properties>2. Test Properties<a hidden class=anchor aria-hidden=true href=#2-test-properties>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># application-test.properties</span>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.url</span><span class=o>=</span><span class=s>jdbc:h2:mem:testdb</span>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.driver-class-name</span><span class=o>=</span><span class=s>org.h2.Driver</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.hibernate.ddl-auto</span><span class=o>=</span><span class=s>create-drop</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.show-sql</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>logging.level.org.springframework.web</span><span class=o>=</span><span class=s>DEBUG</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=performance-testing>Performance Testing<a hidden class=anchor aria-hidden=true href=#performance-testing>#</a></h2><h3 id=1-load-testing>1. Load Testing<a hidden class=anchor aria-hidden=true href=#1-load-testing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>PerformanceTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TestRestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>shouldHandleConcurrentRequests</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>numberOfThreads</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>requestsPerThread</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CountDownLatch</span><span class=w> </span><span class=n>latch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CountDownLatch</span><span class=p>(</span><span class=n>numberOfThreads</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AtomicInteger</span><span class=w> </span><span class=n>successCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicInteger</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AtomicInteger</span><span class=w> </span><span class=n>errorCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicInteger</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>numberOfThreads</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>requestsPerThread</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForEntity</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=s>&#34;/api/users&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>().</span><span class=na>is2xxSuccessful</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>successCount</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>errorCount</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>errorCount</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>latch</span><span class=p>.</span><span class=na>countDown</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}).</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>latch</span><span class=p>.</span><span class=na>await</span><span class=p>(</span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>totalRequests</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>numberOfThreads</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>requestsPerThread</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>successCount</span><span class=p>.</span><span class=na>get</span><span class=p>()).</span><span class=na>isGreaterThan</span><span class=p>(</span><span class=n>totalRequests</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>9</span><span class=p>);</span><span class=w> </span><span class=c1>// 90% success rate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>errorCount</span><span class=p>.</span><span class=na>get</span><span class=p>()).</span><span class=na>isLessThan</span><span class=p>(</span><span class=n>totalRequests</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1</span><span class=p>);</span><span class=w> </span><span class=c1>// Less than 10% errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=test-coverage>Test Coverage<a hidden class=anchor aria-hidden=true href=#test-coverage>#</a></h2><h3 id=1-jacoco-configuration>1. JaCoCo Configuration<a hidden class=anchor aria-hidden=true href=#1-jacoco-configuration>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.jacoco<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>jacoco-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>0.8.8<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goal&gt;</span>prepare-agent<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;id&gt;</span>report<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;phase&gt;</span>test<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goal&gt;</span>report<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-coverage-goals>2. Coverage Goals<a hidden class=anchor aria-hidden=true href=#2-coverage-goals>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.jacoco<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>jacoco-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;rules&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;rule&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;element&gt;</span>BUNDLE<span class=nt>&lt;/element&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;limits&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;limit&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&lt;counter&gt;</span>LINE<span class=nt>&lt;/counter&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&lt;value&gt;</span>COVEREDRATIO<span class=nt>&lt;/value&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&lt;minimum&gt;</span>0.80<span class=nt>&lt;/minimum&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;/limit&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/limits&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/rule&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/rules&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=best-practices>Best Practices<a hidden class=anchor aria-hidden=true href=#best-practices>#</a></h2><h3 id=1-test-naming>1. Test Naming<a hidden class=anchor aria-hidden=true href=#1-test-naming>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ✅ Good naming</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>shouldReturnUserWhenValidIdProvided</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>shouldThrowExceptionWhenUserNotFound</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ❌ Bad naming</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>test1</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>testUser</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-test-structure-aaa-pattern>2. Test Structure (AAA Pattern)<a hidden class=anchor aria-hidden=true href=#2-test-structure-aaa-pattern>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>shouldCreateUserSuccessfully</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Arrange - Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateUserRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>request</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ... setup data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>when</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>existsByUsername</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ... setup mocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Act - When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Assert - Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>isNotNull</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;johndoe&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ... verify results</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-test-isolation>3. Test Isolation<a hidden class=anchor aria-hidden=true href=#3-test-isolation>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@BeforeEach</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>setUp</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Reset mocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>reset</span><span class=p>(</span><span class=n>userRepository</span><span class=p>,</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Clear database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>userRepository</span><span class=p>.</span><span class=na>deleteAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=kết-luận>Kết Luận<a hidden class=anchor aria-hidden=true href=#kết-luận>#</a></h2><p>Testing trong Spring Boot cung cấp một bộ công cụ mạnh mẽ để đảm bảo chất lượng code. Với những kiến thức này, bạn có thể:</p><ul><li>Viết unit test hiệu quả với Mockito</li><li>Thực hiện integration test với TestContainers</li><li>Test performance và load</li><li>Đo lường test coverage</li><li>Áp dụng best practices</li></ul><p>Trong bài viết tiếp theo, tôi sẽ hướng dẫn về Docker và deployment! 🚀</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/java/>Java</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/spring-boot/>Spring-Boot</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/testing/>Testing</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/junit/>Junit</a></li><li><a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/tags/mockito/>Mockito</a></li></ul><nav class=paginav><a class=prev href=https://nguyenthanhluan09060024.github.io/my-programming-blog/posts/react-hooks-guide/><span class=title>« Prev</span><br><span>Hướng Dẫn React Hooks Cho Người Mới Bắt Đầu</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://nguyenthanhluan09060024.github.io/my-programming-blog/>My Programming Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>